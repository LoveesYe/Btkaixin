var bt_tools={commandConnectionPool:{},table:function(a){var b=this;function c(d){this.config=d;this.$load()}c.prototype={style_list:[],event_list:{},checkbox_list:[],batch_active:{},event_rows_model:{},data:[],page:"",column:[],batch_thread:[],random:bt.get_random(5),init:false,checked:false,$load:function(){var d=this;if(this.config.init){this.config.init(this)}$(this.config.el).addClass("bt_table");if(this.config.minWidth){this.style_list.push({className:this.config.el+" table",css:("min-width:"+this.config.minWidth)})}if(this.config.tootls){this.$reader_tootls(this.config.tootls)}else{if($(d.config.el+".divtable").length===0){$(d.config.el).append('<div class="divtable mtb10" style="height:'+(this.config.height||"auto")+'"></div>')}}this.$reader_content();if(d.config.url!==undefined){this.$refresh_table_list(d.config.load||false)}else{if(this.config.data!==undefined){this.$reader_content(this.config.data)}else{alert("缺少data或url参数")}}if(this.config.methods){$.extend(this,this.config.methods)}if(this.config.height){bt_tools.$fixed_table_thead(this.config.el+" .divtable")}},$refresh_table_list:function(e,g){var d=this,f;if(e){f=bt_tools.load("获取列表数据")}this.$http(function(h){if(f){f.close()}if(g){g(h)}d.$reader_content(h.data,typeof h.total!="undefined"?parseInt(h.total):h.page)})},$reader_content:function(v,k){var w=this,s="",d="",r=0,h=this.config.column,g={},o=$(w.config.el+" .checkbox_"+w.random);v=v||[];this.data=v;if(o.length){o.removeClass("active selected");w.checkbox_list=[];w.$set_batch_view()}do{var l=v[r],n=0;if(v.length>0){d+="<tr>"}for(var q=0;q<h.length;q++){var t=h[q];if($.isEmptyObject(t)){n++;continue}if(r===0&&!this.init){if(!this.init){this.style_list.push(this.$dynamic_merge_style(t,q-n))}var e="sort_"+this.random+"",m="checkbox_"+this.random,p=t.sortValue||"desc";s+="<th><span "+(t.sort?'class="not-select '+e+(t.sortValue?" sort-active":"")+' cursor-pointer"':"")+' data-index="'+q+'" '+(t.sort?'data-sort="'+p+'"':"")+">"+(t.type=="checkbox"?'<label><i class="cust—checkbox cursor-pointer '+m+'" data-checkbox="all"></i><input type="checkbox" class="cust—checkbox-input"></label>':"<span>"+t.title+"</span>")+(t.sort?'<span class="glyphicon glyphicon-triangle-'+(p=="desc"?"bottom":"top")+' ml5"></span>':"")+"</span></th>";if(r===0){if(!g[e]&&t.sort){g[e]={event:this.config.sortEvent,eventType:"click",type:"sort"}}if(!g[m]){g[m]={event:t.checked,eventType:"click",type:"checkbox"}}}}if(l!==undefined){var u="",f="event_"+t.fid+"_"+this.random;if(t.template){u=w.$custom_template_render(t,l,q)}if(typeof u==="undefined"||typeof t.template==="undefined"){u=this.$reader_column_type(t,l);g=$.extend(g,u[1]);u=u[0]}d+="<td><span "+(t["class"]?'class="'+t["class"]+'"':"")+" "+(t.tips?'title="'+t.tips+'"':"")+">"+u+"</span></td>";if(r===0){if(!g[f]&&t.event){g[f]={event:t.event,eventType:"click",type:"rows"}}}}}if(v.length>0){d+="</tr>"}if(v.length==0){d+='<tr><td colspan="'+h.length+'" style="text-align:center;">'+(this.config["default"]||"数据为空")+"</td></tr>"}r++}while(r<v.length);if(!this.init){this.$style_bind(this.style_list)}this.$event_bind(g);if(!this.init){$(this.config.el+" .divtable").append('<table class="table table-hover"><thead style="position: relative;z-index: 1;">'+s+"</thead><tbody>"+d+"</tbody></table></div></div>")}else{$(this.config.el+" .divtable tbody").html(d);if(this.config.page){$(this.config.el+" .page").replaceWith(this.$reader_page(this.config.page,k))}}this.init=true;if(this.config.success){this.config.success(this)}},$custom_template_render:function(h,i,e){var f="event_"+h.fid+"_"+this.random,g=h.template(i,e),d=$(g);if(d.length>0){template=d.addClass(f)[0].outerHTML}else{if(h.type==="text"){template='<span class="'+f+" "+h["class"]+'">'+g+"</span>"}else{template='<a href="javascript:;" class="btlink '+f+'">'+g+"</a>"}}return template},$modify_row_data:function(f){this.event_rows_model.rows=$.extend(this.event_rows_model.rows,f);var e=this.event_rows_model,d=null;if(typeof e.model.template!="undefined"){d=$(this.$custom_template_render(e.model,e.rows,e.index));if(!d.length){d=$(this.$reader_column_type(e.model,e.rows)[0])}}else{d=$(this.$reader_column_type(e.model,e.rows)[0])}if(e.model.type=="group"){$(e.el).parent().empty().append(d)}else{e.el.replaceWith(d)}e.el=d},$batch_success_table:function(d){var e=this,f=$(d.html).length;bt.open({type:1,title:d.title,area:d.area||["350px","350px"],shadeClose:false,closeBtn:2,content:d.content||'<div class="batch_title"><span class><span class="batch_icon"></span><span class="batch_text">'+d.title+'操作完成！</span></span></div><div class="'+(f>4?"fiexd_thead":"")+' batch_tabel divtable" style="margin: 15px 30px 15px 30px;overflow: auto;height: 200px;"><table class="table table-hover"><thead><tr><th>'+d.th+'</th><th style="text-align:right;width:120px;">操作结果</th></tr></thead><tbody>'+d.html+"</tbody></table></div>",success:function(){if(f>4){e.$fixed_table_thead(".fiexd_thead")}}})},$delete_table_row:function(d){this.data.splice(d,1);this.$reader_content(this.data)},$set_batch_view:function(){if(typeof this.config.batch!="undefined"){var e=$(this.config.el+" .set_batch_option");if(typeof this.config.batch.config!="undefined"){if(this.checkbox_list.length>0){e.removeClass("bt-disabled btn-default").addClass("btn-success").text("批量"+this.batch_active.title+"(已选中"+this.checkbox_list.length+")")}else{e.addClass("bt-disabled btn-default").removeClass("btn-success").text("批量"+this.batch_active.title)}}else{var d=$(this.config.el+" .bt_table_select_group .bt_select_value");if(this.checkbox_list.length>0){e.removeClass("bt-disabled btn-default").addClass("btn-success").prev().removeClass("bt-disabled");d.find("em").html("(已选中"+this.checkbox_list.length+")")}else{e.addClass("bt-disabled btn-default").removeClass("btn-success").prev().addClass("bt-disabled");d.children().eq(0).html("请选择批量操作<em></em>");d.next().find("li").removeClass("active");this.batch_active={}}}}},$reader_column_type:function(o,p){var n=p[o.fid],d={},j="click_"+o.fid+"_"+this.random,f=[],h=this;switch(o.type){case"text":f=[n,d];break;case"checkbox":f=['<label><i class="cust—checkbox cursor-pointer checkbox_'+this.random+'"></i><input type="checkbox" class="cust—checkbox-input"></label>',d];break;case"password":var m="",l="",j="ico_"+h.random+"_",i='<span class="bt-table-password mr10"><i>**********</i></span>';if(o.eye_open){i+='<span class="glyphicon cursor pw-ico glyphicon-eye-open mr10 '+j+'eye_open" title="显示密码"></span>';if(!d[j+"eye_open"]){d[j+"eye_open"]={type:"eye_open_password"}}}if(o.copy){i+='<span class="ico-copy cursor btcopy mr10 '+j+'copy" title="复制密码"></span>';if(!d[j+"copy"]){d[j+"copy"]={type:"copy_password"}}}f=[i,d];break;case"link":j=j+"_"+o.name;if(!d[j]&&o.event){d[j]={event:o.event,type:"rows"}}f=['<a class="btlink '+j+'" href="'+(o.href?n:"javascript:;")+'" '+(o.href?('target="'+(o.target||"_blank")+'"'):"")+' title="'+n+'">'+n+"</a>",d];break;case"input":blurName="blur_"+o.fid+"_"+this.random;keyupName="keyup_"+o.fid+"_"+this.random;if(!d[blurName]&&o.blur){d[blurName]={event:o.blur,eventType:"blur",type:"rows"}}if(!d[keyupName]&&o.keyup){d[keyupName]={event:o.keyup,eventType:"keyup",type:"rows"}}f=['<input type="text" title="点击编辑内容，按回车或失去焦点自动保存"  class="table-input '+blurName+" "+keyupName+'" data-value="'+n+'" value="'+n+'" />',d];break;case"status":var g="";$.each(o.config.list,function(r,q){if(q[0]===n){g=q}});if(!d[j]&&o.event){d[j]={event:o.event,type:"rows"}}f=['<a class="btlink '+j+" "+(g[2].indexOf("#")>-1?"":g[2])+'" style="'+(g[2].indexOf("#")>-1?("color:"+g[2]+";"):"")+'" href="javascript:;"><span>'+g[1]+"</span>"+(o.config.icon?'<span class="glyphicon '+g[3]+'"></span>':"")+"</a>",d];break;case"switch":var g="",k=bt.get_random(5);g=new Number(n)==true?"checked":"";if(!d[j]&&o.event){d[j]={event:o.event,type:"rows"}}f=['<div class="switch_group"><input class="btswitch btswitch-ios '+j+'" id="'+k+'" type="checkbox" '+g+'><label class="btswitch-btn" for="'+k+'" data-index="0" bt-event-click="set_site_server_status"></label></div>',d];break;case"group":var e="";$.each(o.group,function(t,r){j=(o.fid?o.fid:"group")+"_"+t+"_"+h.random;var q=false;if(r.template){var u=r.template(p,h),s=$(u);if(s.length>0){e+=s.addClass(j)[0].outerHTML}else{e+='<a href="javascript:;" class="btlink '+j+'" title="'+(r.title||"")+'">'+u+"</a>"}}else{if(typeof r.hide!="undefined"){q=typeof r.hide==="boolean"?r.hide:r.hide(p);if(typeof q!="boolean"){return false}}e+='<a href="javascript:;" class="btlink '+j+'" '+(q?'style="display:none;"':"")+' title="'+(r.tips||r.title)+'">'+r.title+"</a>"}if(!q){e+=((o.group.length==(t+1))?"":"&nbsp;&nbsp;|&nbsp;&nbsp;")}if(!d[j]&&r.event){d[j]={event:r.event,type:"rows"}}});f=[e,d];break;default:f=[n,d];break}return f},$batch_success_table:function(d){b.$batch_success_table(d)},$reader_tootls:function(r){var t=this,f={};function g(y,x){var z=bt.load("正在执行批量"+y.title+"，请稍候..."),i={},w=t.$get_data_batch_list(y.paramId,x);if(!y.beforeRequest){i[y.paramName]=w.join(",")}else{i[y.paramName]=y.beforeRequest(x)}bt_tools.send({url:y.url||t.config.batch.url,data:$.extend(y.param||{},i)},function(B){z.close();if(B.status===false&&typeof B.success==="undefined"){bt_tools.msg(B);return false}if(typeof y.tips==="undefined"||y.tips){var A="";$.each(B.error,function(C,D){A+='<tr><td><span class="text-overflow" title="'+C+'">'+C+'</span/></td><td><div style="float:right;" class="size_ellipsis"><span style="color:red">'+D+"</span></div></td></tr>"});$.each(B.success,function(C,D){A+='<tr><td><span class="text-overflow" title="'+D+'">'+D+'</span></td><td><div style="float:right;" class="size_ellipsis"><span style="color:#20a53a">操作成功</span></div></td></tr>'});t.$batch_success_table({title:"批量"+y.title,th:y.theadName,html:A});if(y.refresh){t.$refresh_table_list(true)}}else{if(!y.success){var A="";$.each(x,function(C,D){A+='<tr><td><span class="text-overflow" title="'+D.name+'">'+D.name+'</span></td><td><div style="float:right;"><span style="color:'+(B.status?"#20a53a":"red")+'">'+((typeof y.theadValue!="undefined"?y.theadValue[B.status?0:1]:null)||B.msg)+"</span></div></td></tr>"});t.$batch_success_table({title:"批量"+y.title+"完成",th:y.theadName,html:A});if(y.refresh){t.$refresh_table_list(true)}}}if(y.success){y.success(B,x,t)}})}function k(x,w,y){var i={loadT:0,config:{},check_list:w,bacth_status:true,start_batch:function(z,B){var A=this;if(typeof z=="undefined"){z={}}if(typeof z=="function"){B=z,z={}}if(x.load){this.loadT=layer.msg("正在执行批量"+x.title+'，<span class="batch_progress">进度:0/'+this.check_list.length+"</span>,请稍候...",{icon:16,skin:"batch_tips",shade:0.3,time:0,area:"400px"})}this.config={param:z,url:x.url};this.bacth(B)},bacth:function(z,F){var E=this,D={};if(typeof z==="function"||typeof z==="undefined"){F=z,z=0}if(z<this.check_list.length){"function"==typeof x.url?this.config.url=x.url(w[z]):this.config.url=x.url;if(typeof x.param=="function"){D=x.param(w[z])}else{D=x.param}this.config.param=$.extend(this.config.param,D);if(typeof x.paramId!="undefined"){E.config.param[x.paramName||x.paramId]=E.check_list[z][x.paramId]}if(typeof x.beforeBacth!="undefined"){this.config.param=$.extend(this.config.param,x.beforeBacth(E.check_list[z]))}if(this.config.param.bacth&&z==this.check_list.length-1){delete this.config.param.bacth}if(!E.bacth_status){return false}if(x.load){$("#layui-layer"+E.loadT).find(".layui-layer-content").html('<i class="layui-layer-ico layui-layer-ico16"></i>正在执行批量'+x.title+'，<span class="batch_progress">进度:'+z+"/"+E.check_list.length+"</span>，请稍候..."+(x.clear?'<a href="javascript:;" class="btlink clear_batch" style="margin-left:20px;">取消</a>':""))}bt_tools.send({url:this.config.url,data:this.config.param,bacth:true},function(G){$.extend(E.check_list[z],{request:{status:typeof G.status==="boolean"?G.status:false,msg:G.msg||"请求网络错误"}},{requests:G});z++;E.bacth(z,F)})}else{if(y){y()}if(F){F(this.check_list)}if(x.automatic){var B="";for(var A=0;A<this.check_list.length;A++){var C=this.check_list[A];B+="<tr><td>"+(typeof C[x.paramThead]!="undefined"?C[x.paramThead]:C.name)+'</td><td><div style="float:right;"><span style="color:'+(C.request.status?"#20a53a":"red")+'">'+C.request.msg+"</span></div></td></tr>"}t.$batch_success_table({title:"批量"+x.title,th:x.theadName,html:B});if(x.refresh){t.$refresh_table_list(true)}t.$clear_table_checkbox()}layer.close(this.loadT)}},clear_bacth:function(){this.bacth_status=false;layer.close(this.loadT)}};if(x.callback){x.callback(i)}else{if(!x.confirm||x.recursion){if(x.confirmVerify){bt.show_confirm("批量操作"+x.title+"已选中","批量"+x.title+"，该操作可能会存在风险，是否继续？",function(z){layer.close(z);if(!x.recursion){g(x,w)}else{i.start_batch()}})}else{bt.confirm({title:"批量"+x.title,msg:"批量"+x.title+"，该操作可能会存在风险，是否继续？"},function(z){layer.close(z);if(!x.recursion){g(x,w)}else{i.start_batch()}})}}else{g(x,w)}}}for(var o=0;o<r.length;o++){var s="",p=r[o];switch(p.type){case"group":$.each(p.list,function(w,i){var y=p.type+"_"+t.random+"_"+w,x="";if(i.type=="division"){s+='<span class="mlr5"></span>'}else{if(!i.group){s+='<button type="button" title="'+(i.tips||i.title)+'" class="btn '+(i.active?"btn-success":"btn-default")+" "+y+' btn-sm mr5" '+b.$verify(t.$reader_style(i.style),"style")+">"+(i.icon?'<span class="glyphicon glyphicon-'+i.icon+' mr5"></span>':"")+"<span>"+i.title+"</span></button>"}else{s+='<div class="btn-group" style="vertical-align: top;">                                        <button type="button" class="btn btn-default '+y+' btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span style="margin-right:2px;">分类管理</span><span class="caret" style="position: relative;top: -1px;"></span></button>                                        <ul class="dropdown-menu"></ul>                                    </div>';if(p.list){$.each(p.list,function(A,z){x+='<li><a href="javascript:;" '+ +">"+z[p.key]+"</a></li>"})}if(i.init){setTimeout(function(){i.init(y)},400)}}}if(!f[y]){f[y]={event:i.event,type:"button"}}});break;case"search":this.config.search=p;var d="search_input_"+this.random,h="search_focus_"+this.random,n="search_btn_"+this.random;s='<div class="bt_search"><input type="text" class="search_input '+d+'" style="'+(p.width?("width:"+p.width):"")+'" placeholder="'+(p.placeholder||"")+'"/><span class="glyphicon glyphicon-search '+n+'" aria-hidden="true"></span></div>';if(!f[d]){f[d]={eventType:"keyup",type:"search_input"}}if(!f[h]){f[h]={type:"search_focus",eventType:"focus"}}if(!f[n]){f[n]={type:"search_btn"}}break;case"batch":this.config.batch=p;var u=[],e="",l=p.config;if(typeof p.config!="undefined"){t.batch_active=l;$(t.config.el).on("click",".set_batch_option",function(z){var y=[];for(var x=0;x<t.checkbox_list.length;x++){y.push(t.data[t.checkbox_list[x]])}if($(this).hasClass("bt-disabled")){layer.tips(t.config.batch.disabledTips||"请选择需要批量操作的数据",$(this),{tips:[1,"red"],time:2000});return false}switch(typeof l.confirm){case"function":l.confirm(l,function(i,A){l.param=$.extend(l.param,i);k(l,y,A)});break;case"undefined":k(l,y);break;case"object":var w=l.confirm;bt.open({title:w.title||"批量操作",area:w.area||"350px",btn:w.btn||["确认","取消"],content:w.content,success:function(i,A){w.success(i,A,l)},yes:function(A,i){w.yes(A,i,function(B,C){l.param=$.extend(l.param,B);g(l,y)})}});break}})}else{$.each(p.selectList,function(w,i){if(i.group){$.each(i.group,function(y,x){u.push($.extend({},i,x));e+='<li class="item">'+x.title+"</li>"});delete i.group}else{u.push(i);e+='<li class="item">'+i.title+"</li>"}});$(t.config.el).unbind().on("click",".bt_table_select_group .bt_select_value",function(z){var A=this,y=$(this).parent(),i=y.find(".bt_selects"),x=y.offset(),w=t.$get_win_area();if(y.hasClass("bt-disabled")){layer.tips(t.config.batch.disabledSelectValue,y,{tips:[1,"red"],time:2000});return false}if(y.hasClass("active")){y.removeClass("active")}else{y.addClass("active")}if(i.height()>(w[1]-x.top)){i.addClass("top")}else{i.removeClass("top")}$(document).one("click",function(){$(t.config.el).find(".bt_table_select_group").removeClass("active");return false});return false});$(t.config.el).on("click",".bt_table_select_group .item",function(w){var i=$(this).text(),x=$(this).index();$(this).addClass("active").siblings().removeClass("active");$(t.config.el+" .bt_select_tips").html("批量"+i+"<em>(已选中"+t.checkbox_list.length+")</em>");t.batch_active=u[x];if(!t.checked){$(".bt_table_select_group").removeClass("active")}});$(t.config.el).on("click",".set_batch_option",function(B){var A=[],z=t.batch_active;if($(this).hasClass("bt-disabled")){layer.tips(t.config.batch.disabledSelectValue,$(this),{tips:[1,"red"],time:2000});return false}for(var y=0;y<t.checkbox_list.length;y++){A.push(t.data[t.checkbox_list[y]])}if(JSON.stringify(z)==="{}"){var w=$(t.config.el+" .bt_table_select_group");layer.tips("请选择需要批量操作的类型",w,{tips:[1,"red"],time:2000});w.css("border","1px solid red");setTimeout(function(){w.removeAttr("style")},2000);return false}switch(typeof z.confirm){case"function":z.confirm(z,function(i,C){z.param=$.extend(z.param,i);k(z,A,C)});break;case"undefined":k(z,A);break;case"object":var x=z.confirm;bt.open({title:x.title||"批量操作",area:x.area||"350px",btn:x.btn||["确认","取消"],content:x.content,success:function(i,C){x.success(i,C,z)},yes:function(C,i){x.yes(C,i,function(D,E){z.param=$.extend(z.param,D);g(z,A)})}});break}})}s='<div class="bt_batch"><label><i class="cust—checkbox cursor-pointer checkbox_'+this.random+'" data-checkbox="all"></i><input type="checkbox" lass="cust—checkbox-input" /></label>'+(typeof p.config!="undefined"?'<button class="btn btn-default btn-sm set_batch_option bt-disabled">批量'+p.config.title+"</button>":'<div class="bt_table_select_group bt-disabled not-select"><span class="bt_select_value"><span class="bt_select_tips">请选择批量操作<em></em></span><span class="glyphicon glyphicon-triangle-bottom ml5"></span></span><ul class="bt_selects ">'+e+'</ul></div><button class="btn btn-default btn-sm set_batch_option bt-disabled" >'+p.buttonValue+"</button>")+"</div>";break;case"page":this.config.page=p;var q=bt.get_cookie("page_number");if(this.config.cookiePrefix&&q){this.config.page.number=q}s=this.$reader_page(this.config.page,'<div><span class="Pcurrent">1</span><span class="Pcount">共0条数据</span></div>');break}if(s){var v=$(t.config.el+" .tootls_"+p.positon[1]);if(v.length){var m=v.find(".pull-"+p.positon[0]);m.append(s)}else{var j='<div class="tootls_group tootls_'+p.positon[1]+'"><div class="pull-left">'+(p.positon[0]=="left"?s:"")+'</div><div class="pull-right">'+(p.positon[0]=="right"?s:"")+"</div></div>";if(p.positon[1]==="top"){$(t.config.el).append(j);if($(t.config.el+" .divtable").length===0){$(t.config.el).append('<div class="divtable mtb10" style="max-height:'+t.config.height+'px"></div>')}}else{if($(t.config.el+" .divtable").length===0){$(t.config.el).append('<div class="divtable mtb10" style="max-height:'+t.config.height+'px"></div>')}$(t.config.el).append(j)}}}}if(!this.init){this.$event_bind(f)}},$clear_table_checkbox:function(){$(this.config.el).find(".bt_table .cust—checkbox").removeClass("selected active")},$get_data_batch_list:function(f,d){var e=[];$.each(d||this.data,function(g,h){e.push(h[f])});return e},$reader_page:function(e,j){if(typeof j==="number"){j=this.$custom_page(j)}var f=this,h=$(j),m="",d={};h.find("a").addClass("page_link_"+this.random);m+=h.html();if(e.numberStatus){var k="page_select_"+this.random,g=bt.get_cookie("page_number");m+='<select class="page_select_number '+k+'">';$.each(e.numberList,function(n,o){m+='<option value="'+o+'" '+((g||e.number)==o?"selected":"")+">"+o+"条/页</option>"});m+="</select>";d[k]={eventType:"change",type:"page_select"}}if(e.jump){var i="page_jump_input_"+this.random;var l="page_jump_btn_"+this.random;m+='<div class="page_jump_group"><span class="page_jump_title">跳转到</span><input type="number" class="page_jump_input '+i+'" value="'+e.page+'" /><span class="page_jump_title">页</span><button type="button" class="page_jump_btn '+l+'">确认</button></div>';d[i]={eventType:"keyup",type:"page_jump_input"};d[l]={type:"page_jump_btn"}}d["page_link_"+this.random]={type:"cut_page_number"};f.config.page.total=h.length==0?0:(typeof j=="number"?j:parseInt(h.find(".Pcount").html().match(/([0-9]*)/g)[1]));f.$event_bind(d);return'<div class="page">'+m+"</div>"},$reader_style:function(e){var d="";if(typeof e==="string"){return e}if(typeof e==="undefined"){return""}$.each(e,function(f,g){d+=f+":"+g+";"});return d},$custom_page:function(g){var f='<div class="page">',d=this.config.page,j=Math.ceil(g/d.number),h=0;if(d.page>1&&j>1){f+='<a class="Pstart" href="p=1">首页</a><a class="Pstart" href="p='+(d.page-1)+'">上一页</a>'}if(j<=10){for(var e=1;e<=j;e++){e==d.page?f+='<span class="Pcurrent">'+e+"</span>":f+='<a class="Pnum" href="p='+e+'">'+e+"</a>"}}else{if(d.page<10){for(var e=1;e<=10;e++){e==d.page?f+='<span class="Pcurrent">'+e+"</span>":f+='<a class="Pnum" href="p='+e+'">'+e+"</a>"}f+="<span>...</span>"}else{if(j-d.page<7){j-7>1&&(f+='<a class="Pnum" href="p=1">1</a>',f+="<span>...</span>");for(var e=j-7;e<=j;e++){e==d.page?f+='<span class="Pcurrent">'+e+"</span>":(f+=1==e?"<span>...</span>":'<a class="Pnum" href="p='+e+'">'+e+"</a>")}}else{0==h&&(h=d.page),(h<=d.page-5||h>=d.page+5)&&(h=d.page),f+='<a class="Pnum" href="p=1">1</a>',f+="<span>...</span>";for(var e=h-3;e<=h+3;e++){e==d.page?f+='<span class="Pcurrent">'+e+"</span>":f+='<a class="Pnum" href="p='+e+'">'+e+"</a>"}f+="<span>...</span>",f+='<a class="Pnum" href="p='+j+'">'+j+"</a>"}}}return j>1&&d.page<j&&(f+='<a class="Pstart" href="p='+(d.page+1)+'">下一页</a><a class="Pstart" href="p='+j+'">尾页</a>'),f+='<span class="Pcount">共'+g+"条</span></div>"},$dynamic_merge_style:function(e,d){var f="";$.each(e,function(g,h){switch(g){case"align":f+="text-align:"+h+";";break;case"width":f+="width:"+(typeof h=="string"?h:h+"px")+";";break;case"style":f+=h;break;case"minWidth":f+="min-width:"+(typeof h=="string"?h:h+"px")+";";break;case"maxWidth":f+="max-width:"+(typeof h=="string"?h:h+"px")+";";break}});return{index:d,css:f}},$event_bind:function(e){var d=this;$.each(e,function(f,g){if(d.event_list[f]&&d.event_list[f].eventType===g.eventType){return true}d.event_list[f]=g;$(d.config.el).on(g.eventType||"click","."+f,function(r){var p=$(this).parents("tr").index(),l=$(this).data(),o=[];switch(g.type){case"rows":d.event_rows_model={el:$(this),model:d.config.column[$(this).parents("td").index()],rows:d.data[p],index:p};o=[d.event_rows_model.rows,d.event_rows_model.index,r,f,d];break;case"sort":var n=d.config.column[l.index];if($(this).hasClass("sort-active")){$(".sort_"+d.random+" .sort-active").data({sort:"desc"})}$(".sort_"+d.random).removeClass("sort-active").find(".glyphicon").removeClass("glyphicon-triangle-top").addClass("glyphicon-triangle-bottom");$(this).addClass("sort-active");if(l.sort=="asc"){$(this).data({sort:"desc"});$(this).find(".glyphicon").removeClass("glyphicon-triangle-top").addClass("glyphicon-triangle-bottom")}else{$(this).data({sort:"asc"});$(this).find(".glyphicon").removeClass("glyphicon-triangle-bottom").addClass("glyphicon-triangle-top")}d.config.sort=d.config.sortParam({name:n.fid,sort:l.sort});d.$refresh_table_list(true);break;case"checkbox":var u=$(d.config.el+' [data-checkbox="all"]'),j=$(d.config.el+" tbody .checkbox_"+d.random);if(l.checkbox==undefined){if(!$(this).hasClass("active")){$(this).addClass("active");d.checkbox_list.push(p);if(d.data.length===d.checkbox_list.length){u.addClass("active").removeClass("selected")}else{if(d.checkbox_list.length>0){u.addClass("selected")}}}else{$(this).removeClass("active");d.checkbox_list.splice(d.checkbox_list.indexOf(p),1);if(d.checkbox_list.length>0){u.addClass("selected").removeClass("active")}else{u.removeClass("selected active")}}}else{if(d.checkbox_list.length===d.data.length){d.checkbox_list=[];j.removeClass("active selected").next().prop("checked","checked");u.removeClass("active")}else{j.each(function(v,w){if(!$(this).hasClass("active")){$(this).addClass("active").next().prop("checked","checked");d.checkbox_list.push(v)}});u.removeClass("selected").addClass("active")}}d.$set_batch_view();break;case"button":o.push(r,d);break;case"search_focus":var t=$(d.config.el+" .bt_search_tips");if($(d.config.el+" .bt_search_tips").length>0){t.remove()}break;case"search_input":if(r.keyCode==13){$(d.config.el+" .search_btn_"+d.random).click();return false}break;case"search_btn":var m=$(d.config.el+" .search_input"),i=$(d.config.el+" .search_input").val();i=i.replace(/\s+/g,"");m.val(i);d.config.search.value=i;m.append('<div class="bt_search_tips"><span>'+i+'</span><i class="bt_search_close"></i></div>');d.$refresh_table_list(true);break;case"page_select":var k=parseInt($(this).val());bt.set_cookie("page_number",k);d.config.page.number=k;d.config.page.page=1;d.$refresh_table_list(true);return false;break;case"page_jump_input":if(r.keyCode===13){$(d.config.el+" .page_jump_btn_"+d.random).click();$(this).focus()}return false;break;case"page_jump_btn":var s=parseInt($(d.config.el+" .page_jump_input_"+d.random).val()),h=Math.ceil(d.config.page.total/d.config.page.number);if(isNaN(s)){s=1}if(s>h){s=d.config.page.page}d.config.page.page=s;d.$refresh_table_list(true);break;case"cut_page_number":var q=parseInt($(this).attr("href").match(/([0-9]*)$/)[0]);d.config.page.page=q;d.$refresh_table_list(true);return false;break;case"eye_open_password":if($(this).hasClass("glyphicon-eye-open")){$(this).addClass("glyphicon-eye-close").removeClass("glyphicon-eye-open");$(this).prev().text(d.data[p].password)}else{$(this).addClass("glyphicon-eye-open").removeClass("glyphicon-eye-close");$(this).prev().html("<i>**********</i>")}return false;break;case"copy_password":bt.pub.copy_pass(d.data[p].password);return false;break}if(g.event){g.event.apply(this,o)}})})},$style_bind:function(f,d){var g="",e=this;$.each(f,function(h,i){if(i.css!=""){if(!i.className){g+=e.config.el+" thead th:nth-child("+(i.index+1)+"),"+e.config.el+" tbody tr td:nth-child"+(i.span?" span":"")+"("+(i.index+1)+"){"+i.css+"}"}else{g+=i.className+"{"+i.css+"}"}}});if($("#bt_table_"+e.random).length==0){$(e.config.el).append('<style type="text/css" id="bt_table_'+e.random+'">'+g+"</style>")}},$get_win_area:function(){return[window.innerWidth,window.innerHeight]},$http:function(k){var e=bt.get_cookie("page_number"),h=this,j={},f=this.config,g=f.page,i=f.search,d=f.sort||{};if(g){if(e){g.number=e}j[g.numberParam]=g.number,j[g.pageParam]=g.page;bt.set_cookie("page_number",g.number)}if(i){j[i.searchParam]=i.value}if(this.config.beforeRequest){f.param=this.config.beforeRequest($.extend(f.param,j,d))}else{f.param=$.extend(f.param,j,d)}bt_tools.send({url:f.url,data:f.param},function(l){if(typeof f.dataFilter!="undefined"){var m=f.dataFilter(l,h);if(typeof m.tootls!="undefined"){m.tootls=parseInt(m.tootls)}if(k){k(m)}}else{if(void 0==l.data){k&&k({data:l})}else{k&&k({data:l.data,page:l.page})}}})}};return new c(a)},form:function(a){var b=this;function c(d){this.config=d;this.el=d.el;this.submit=d.submit;this.data=d.data||{};this.$load()}c.prototype={element:null,style_list:[],event_list:{},event_type:["click","event","focus","keyup","blur","change","input"],hide_list:[],form_element:{},form_config:{},random:bt.get_random(5),$load:function(){var d=this;if(this.el){$(this.el).html(this.$reader_content());this.$event_bind()}},$reader_content:function(g){var f=this,e="",d="";$.each(f.config.form,function(h,i){if(i.separate){e+='<div class="bt_form_separate"><span class="btn btn-sm btn-default">'+i.separate+"</span></div>"}else{e+=f.$reader_content_row(h,i)}});f.element=$('<form class="bt-form" data-form="'+f.random+'" onsubmit="return false">'+e+"</form>");d=$('<div class="'+b.$verify(f.config["class"])+'"></div>');d.append(f.element);if(g){g()}return d[0].outerHTML},$reader_content_row:function(g,i){try{var h=this,f=i.help||false,d=i.formLabelWidth||this.config.formLabelWidth;if(i.display===false){return""}return'<div class="line'+b.$verify(i["class"])+b.$verify(i.hide,"hide",true)+'"'+b.$verify(i.id,"id")+">"+(typeof i.label!=="undefined"?'<span class="tname" '+(d?'style="width:'+d+'"':"")+">"+i.label+"</span>":"")+'<div class="'+(i.label?"info-r":"")+b.$verify(i.line_class)+'"'+b.$verify(h.$reader_style($.extend(i.style,d?{"margin-left":d}:{})),"style")+">"+h.$reader_form_element(i.group,g)+(f?('<div class="c9 mt5 '+b.$verify(f["class"],"class")+'" '+b.$verify(h.$reader_style(f.style),"style")+">"+f.list.join("</br>")+"</div>"):"")+"</div></div>"}catch(e){console.log(e)}},$reader_form_element:function(g,d){var f=this,e="";if(!Array.isArray(g)){g=[g]}$.each(g,function(h,i){i.find_index=d;e+=f.$reader_form_find(i);f.form_config[i.name]=i});return e},$reader_form_find:function(m){var j=this,h="",d=j.$reader_style(m.style)+b.$verify(m.width,"width","style"),e=j.$verify_group(m,["name","placeholder","disabled","readonly","autofocus","autocomplete","min","max"]),o=j.$create_event_config(m),i="",k=m.find_index;if(m.display===false){return h}h+=m.label?'<span class="mr5 inlineBlock">'+m.label+"</span>":"";if(typeof m.name!=="undefined"){j.$check_event_bind(m.name,o)}h+='<div class="'+(m.dispaly||"inlineBlock")+" "+b.$verify(m.hide,"hide",true)+" "+(m["class"]||"")+'">';var n=typeof j.data[m.name]!=="undefined"&&j.data[m.name]!=""?j.data[m.name]:(m.value||"");switch(m.type){case"text":case"checkbox":case"password":case"radio":case"number":var g="event_"+m.name+"_"+j.random;switch(m.type){case"checkbox":h+='<label class="cursor-pointer form-checkbox-label" '+b.$verify(j.$reader_style(m.style),"style")+'><i class="form-checkbox cust—checkbox cursor-pointer mr5 '+g+"_label "+(n?"active":"")+'"></i><input type="checkbox" class="form—checkbox-input hide mr10 '+g+'" name="'+m.name+'" '+(n?"checked":"")+'/><span class="vertical_middle">'+m.title+"</span></label>";j.$check_event_bind(g+"_label",{click:{type:"checkbox_icon",config:m}});j.$check_event_bind(g,{input:{type:"checkbox",config:m,event:m.event}});break;default:h+='<input type="'+m.type+'"'+e+" "+(m.icon?'id="'+g+'"':"")+' class="bt-input-'+(m.type!=="select_path"&&m.type!=="number"&&m.type!=="password"?m.type:"text")+" mr10 "+(m.label?"vertical_middle":"")+b.$verify(m["class"])+'"'+b.$verify(d,"style")+' value="'+n+'"/>';break}if(m.btn&&!m.disabled){h+='<span class="btn '+m.btn.type+" "+m.name+'_btn cursor" '+b.$verify(j.$reader_style(m.btn.style),"style")+">"+m.btn.title+"</span>";if(typeof m.btn.event!=="undefined"){j.$check_event_bind(m.name+"_btn",{click:{config:m,event:m.btn.event}})}}if(m.icon){h+='<span class="glyphicon '+m.icon.type+" "+m.name+"_icon cursor "+(m.disabled?"hide":"")+' mr10" '+b.$verify(j.$reader_style(m.icon.style),"style")+"></span>";if(typeof m.icon.event!=="undefined"){j.$check_event_bind(m.name+"_icon",{click:{type:"select_path",select:m.icon.select||"",config:m,children:"."+m.name+"_icon",event:m.icon.event,callback:m.icon.callback}})}}break;case"textarea":h+='<textarea class="bt-input-text"'+b.$verify(d,"style")+e+" >"+n+"</textarea>";$.each(["blur","focus","input"],function(q,p){if(m.tips){var r=null,s={};switch(p){case"blur":r=function(v,u,t){if($(this).val()===""){$(this).next().show()}layer.close(u.tips.loadT);$(v.target).data("layer","")};break;case"focus":r=function(u,t){$(this).next().hide();t.tips.loadT=layer.tips(l,$(this),{tips:[1,"#20a53a"],time:0,area:$(this).width()})};break}}j.event_list[m.name][p]?(j.event_list[m.name][p]["added"]=r):(j.event_list[m.name][p]={type:m.type,cust:false,event:m[p],added:r})});if(m.tips){var l="";if(typeof m.tips.list==="undefined"){l=m.tips.text}else{l=m.tips.list.join("</br>")}h+='<div class="placeholder c9 '+m.name+'_tips" '+b.$verify(j.$reader_style(m.tips.style),"style")+">"+l+"</div>";j.$check_event_bind(m.name+"_tips",{click:{type:"textarea_tips",config:m}})}break;case"select":h+=j.$reader_select(m,d,e,k);j.$check_event_bind("custom_select",{click:{type:"custom_select",children:".bt_select_value"}});j.$check_event_bind("custom_select_item",{click:{type:"custom_select_item",children:"li.item"}});break;case"link":i="event_link_"+j.random;h+='<a href="'+(m.href||"javascript:;")+'" class="btlink '+i+'" '+b.$verify(j.$reader_style(m.style),"style")+">"+m.title+"</a>";j.$check_event_bind(i,{click:{type:"link_event",event:m.event}});break;case"button":h+='<button class="btn btn-success btn-'+(m.size||"sm ")+" "+i+" "+b.$verify(m["class"])+'"  '+b.$verify(j.$reader_style(m.style),"style")+" "+e+">"+m.title+"</button>";break;case"help":var f="";$.each(m.list,function(q,p){f+="<li>"+p+"</li>"});h+='<ul class="help-info-text c7'+b.$verify(m["class"])+'"'+b.$verify(j.$reader_style(m.style),"style")+" "+e+">"+f+"</ul>";break}h+=m.unit?'<span class="'+(m.type==="text-tips"?"text-tips":"unit")+'">'+m.unit+"</span>":"";h+="</div>";return h},$check_event_bind:function(d,e){if(!this.event_list[d]){if(!this.event_list.hasOwnProperty(d)){this.event_list[d]=e}}},$create_event_config:function(e){var d={};if(typeof e.name==="undefined"){return{}}$.each(this.event_type,function(g,f){if(e[f]){d[(f==="event"?"click":f)]={type:e.type,event:e[f],cust:(["select","checkbox","radio"].indexOf(e.type)>-1),config:e}}});return d},$reader_style:function(e){var d="";if(typeof e==="string"){return e}if(typeof e==="undefined"){return""}$.each(e,function(f,g){d+=f+":"+g+";"});return d},$local_refresh:function(e,d){var f=this.element.find("[data-name="+e+"]");if(this.element.find("[data-name="+e+"]").length===0){f=this.element.find("[name="+e+"]")}f.parent().replaceWith(this.$reader_form_find(d))},$reader_select:function(n,e,f,k){var j=this,l="",i="",h={};if(typeof n.list==="function"){var d=n.list;d.call(this,this.config.form);n.list=[]}if(!Array.isArray(n.list)){var g=n.list;bt_tools.send({url:g.url,data:g.param||g.data||{}},function(o){if(o.status!==false){var p=n.list.dataFilter?n.list.dataFilter(o,j):o;if(n.list.success){n.list.success(o,j,j.config.form[k],p)}n.list=p;if(!n.list.length){n.disabled=true;layer.msg(n.placeholder||"数据获取为空",{icon:2})}j.$replace_render_content(k)}else{bt.msg(o)}});return false}if(typeof j.data[n.name]==="undefined"){h=n.list[0]}$.each(n.list,function(p,o){if(o.value===n.value||o.value===j.data[n.name]){h=o;return false}});$.each(n.list,function(p,o){l+='<li class="item'+b.$verify(o.value===h.value?"active":"")+" "+(o.disabled?"disabled":"")+'" title="'+o.title+'">'+o.title+"</li>";i+='<option value="'+o.value+'"'+(o.disabled?"disabled":"")+" "+b.$verify(o.value===h.value?"selected":"")+">"+o.title+"</option>"});var m=!Array.isArray(n.list)?"获取数据中":(h?h.title:n.placeholder);return'<div class="bt_select_updown mr10 '+(n.disabled?"bt-disabled":"")+" "+ +b.$verify(n["class"])+'" '+b.$verify(e,"style")+' data-name="'+n.name+'"><span class="bt_select_value"><span class="bt_select_content" title="'+(m||n.placeholder)+'">'+(m||n.placeholder)+'</span><span class="glyphicon glyphicon-triangle-bottom ml5"></span></span><ul class="bt_select_list">'+(l||"")+"</ul><select"+f+' class="hide" '+(n.disabled?"disabled":"")+' autocomplete="off">'+(i||"")+"</select></div>"},$replace_render_content:function(e){var g=this,d=this.config.form[e],f=g.$reader_content_row(e,d);$("[data-form="+g.random+"]").find(".line:eq("+e+")").replaceWith(f);this.$event_bind()},$again_render_form:function(h){var f=$("[data-form="+this.random+"]"),g=this;h=h||this.config.form;f.empty();for(var e=0;e<h.length;e++){var d=h[e];if(d.display===false){continue}f.append(g.$reader_content_row(e,d))}this.config.form=h;this.$event_bind()},$event_bind:function(f,g){var e=this,d={};e.element=$(typeof f==="object"?e.element:("[data-form="+e.random+"]"));d=f;if(typeof f==="undefined"){d=e.event_list}$.each(d,function(h,i){if($.isEmptyObject(i)){return true}$.each(i,function(l,j){if(!!i.type){return false}if(!j.hasOwnProperty("bind")){j.bind=true}else{return false}var k="";if(typeof j.cust==="boolean"){k="["+(j.cust?"data-":"")+"name="+h+"]"}else{k="."+h}(function(m,n){if(m.onEvent===false){switch(m.type){case"input_checked":$(k).on(l!="event"?l:"click",function(o){m.event.apply(this,[o,e])});break}return true}else{if(m.type==="select"){return true}e.element.on(l!=="event"?l:"click",m.children?m.children:k,function(t){var s=e.$get_form_element(true),q=e.form_config[n];switch(m.type){case"textarea_tips":$(this).hide().prev().focus();break;case"custom_select":if($(this).parent().hasClass("bt-disabled")){return false}var p=$(this).next();if(!p.hasClass("show")){$(".bt_select_list").removeClass("show");p.addClass("show")}else{p.removeClass("show")}$(document).click(function(){e.element.find(".bt_select_list").removeClass("show");$(this).unbind("click");return false});return false;break;case"custom_select_item":q=e.form_config[$(this).parents(".bt_select_updown").attr("data-name")];var o=q.list[$(this).index()];if($(this).hasClass("disabled")){$(this).parent().removeClass("show");if(o.tips){layer.msg(o.tips,{icon:2})}return true}if(!$(this).hasClass("active")&&!$(this).hasClass("disabled")){var u=o.value.toString();$(this).parent().prev().find(".bt_select_content").text($(this).text());$(this).addClass("active").siblings().removeClass("active");$(this).parent().next().val(u);$(this).parent().removeClass("show")}e.data[q.name]=u;if(m.event){m.event=null}if(q.change){m.event=q.change}break;case"select_path":bt.select_path("event_"+$(this).prev().attr("name")+"_"+e.random,m.select||"",!m.callback||m.callback.bind(e));break;case"checkbox":var r=$(this).is(":checked");if(r){$(this).prev().addClass("active")}else{$(this).prev().removeClass("active")}break}if(m.event){m.event.apply(this,[e.$get_form_value(),s,e,q,t])}if(m.added){m.added.apply(this,[t,q,s])}})}}(j,h))})});if(g){g()}},$get_form_value:function(){var d={};this.element.find('input,textarea[disabled="disabled"]').each(function(e,f){var g=$(this).val();if($(this).attr("type")==="checkbox"){g=$(this).prop("checked")}d[$(this).attr("name")]=g});return $.extend({},this.element.serializeObject(),d)},$set_find_value:function(e,g){var d={},f=this;typeof e!="string"?d=e:d[e]=g;$.each(d,function(h,i){f.form_element[h].val(i)})},$get_form_element:function(f){var e={},d=this;if(f||$.isEmptyObject(d.form_element)){this.element.find(":input").each(function(g){e[$(this).attr("name")]=$(this)});d.form_element=e;return e}else{return d.form_element}},$verify_group:function(d,f){var e=this,g="";$.each(f,function(h,i){if(typeof d[i]==="undefined"){return true}if(["disabled","readonly"].indexOf(i)>-1){g+=" "+(d[i]?(i+'="'+i+'"'):"")}else{g+=" "+i+'="'+d[i]+'"'}});return g},$verify_bind_event:function(e,g,f){var d={};$.each(f,function(i,h){var j=g[h];if(j){if(typeof d[e]==="object"){if(!Array.isArray(d[e])){d[e]=[d[e]]}d[e].push({event:j,eventType:h})}else{d[e]={event:j,eventType:h}}}});return d},$verify:function(f,d,e){if(!f){return""}if(e===true){return f?" "+d:""}if(e==="style"){return d?d+":"+f+";":f}return d?" "+d+'="'+f+'"':" "+f},$verify_form:function(){var k={},e=this.config.form,j=this.$get_form_value(),g=this.$get_form_element(true);for(var m=0;m<e.length;m++){var n=e[m];if(!Array.isArray(n.group)){n.group=[n.group]}if(n.separate){continue}for(var f=0;f<n.group.length;f++){var h=n.group[f],d=h.name;if(h.type==="help"){continue}if(typeof h.verify!="undefined"){var l=h.verify(j[d],g[d],h,true);if(l===false&&j[d]!==false){return false}k[d]=l}else{k[d]=(typeof j[d]==="undefined"&&h.disabled)?$('[name="'+d+'"]').val():j[d]}}}return k},$submit:function(f,g,d){var e=this.$verify_form();if(typeof f==="function"){d=g,g=f,f={}}if(!e){return false}e=$.extend(e,f);if(typeof this.config.url=="undefined"){bt_tools.msg("请求提交地址不能为空！",false);return false}bt_tools.send({url:this.config.url,data:e},function(h){if(g){g(h,e)}else{bt_tools.msg(h)}},(d||"提交中"))}};return new c(a)},tab:function(a){var b=this;function c(d){this.config=d;this.theme=this.config.theme||{};this.$load()}c.prototype={type:1,theme_list:[{content:"tab-body",nav:"tab-nav",body:"tab-con",active:"on"},{content:"bt-w-body",nav:"bt-w-menu",body:"bt-w-con"}],random:bt.get_random(5),$init:function(){var f=this,g=this.config.active,e=f.config.list,d={};this.$event_bind();if(e[f.active].success){e[f.active].success()}e[f.active]["init"]=true},$load:function(){var d=this},$reader_content:function(){var i=this,f=i.config.list,h="",g="",e=i.theme,d=i.config;if(typeof i.active==="undefined"){i.active=0}if(!$.isEmptyObject(d.theme)){e=this.theme_list[i.active];$.each(d.theme,function(j,k){if(e[j]){e[j]+=" "+k}});i.theme=e}if(d.type&&$.isEmptyObject(d.theme)){this.theme=this.theme_list[i.active]}$.each(f,function(k,l){var m=(i.active===k),j=e.active||"active";h+='<span class="'+(m?j:"")+'">'+l.title+"</span>";g+='<div class="tab-block '+(m?j:"")+'">'+(m?l.content:"")+"</div>"});i.element=$('<div id="tab_'+i.random+'" class="'+e.content+b.$verify(i.config["class"])+'"><div class="'+e.nav+'" >'+h+'</div><div class="'+e.body+'">'+g+"</div></div>");return i.element[0].outerHTML},$event_bind:function(){var e=this,d=e.theme,f=d.active||"active";if(!e.el){e.element=$("#tab_"+e.random)}e.element.on("click",("."+d.nav.replace(/\s+/g,".")+" span"),function(){var h=$(this).index(),g=e.config.list[h];$(this).addClass(f).siblings().removeClass(f);$("#tab_"+e.random+" ."+d.body+">div:eq("+h+")").addClass(f).siblings().removeClass(f);e.active=h;if(!g.init){$("#tab_"+e.random+" ."+d.body+">div:eq("+h+")").html(g.content);if(g.success){g.success()}g.init=true}})}};return new c(a)},load:function(f){var c=bt.get_random(5),g=$('<div class="layui-layer layui-layer-dialog layui-layer-msg layer-anim" id="'+c+'" type="dialog" style="z-index: 99891031;"><div class="layui-layer-content layui-layer-padding"><i class="layui-layer-ico layui-layer-ico16"></i>正在'+f+'，请稍候...</div><span class="layui-layer-setwin"></span></div><div class="layui-layer-shade" id="layer-mask-'+c+'" times="17" style="z-index:99891000; background-color:#000; opacity:0.3; filter:alpha(opacity=30);"></div>'),a="",e="";$("body").append(g);var d=$(window),b=$(".layer-loading-mask"),g=$("#"+c);g.css({top:((d.height()-64)/2),left:((d.width()-320)/2)});if(f===true){e=layer.load()}return{close:function(){if(typeof e=="number"){layer.close(e)}else{$("body").find("#"+c+",#layer-mask-"+c).remove()}}}},open:function(a){var d={},c=null,b=null;d=$.extend({type:1,area:"640px",closeBtn:2,btn:["确认","取消"]},a);if(typeof d.content=="object"){var e=d.content;b=bt_tools.form(e);d.success=function(f,g){b.$event_bind();if(typeof a.success!="undefined"){a.success(f,g)}};d.yes=function(i,f){var g=b.$verify_form();if(!g){return false}if(typeof a.yes!="undefined"){var h=a.yes.apply(b,[g,i,f]);if(!h){return false}}};d.content=b.$reader_content()}c=layer.open(d);return{close:function(){layer.close(c)},form:b}},msg:function(e,c){var b=null,d="",a={};if(typeof e==="object"){if(typeof e.status==="boolean"){d=e.msg,a={icon:e.status?1:2};if(!e.status){a=$.extend(a,{time:(!c?0:3000),closeBtn:2,shade:0.3})}}}if(typeof e==="string"){d=e,a={icon:typeof c!=="undefined"?c:1}}b=layer.msg(d,a);return{close:function(){layer.close(b)}}},send:function(g,e,c,b,a,l){var h={},k=null,i=null,f=[],j="";$.each(arguments,function(n,m){f.push([m,typeof m])});function d(n){try{k=f[n][1]=="function"?f[n][0]:null;m=f[(n+1)][1]=="function"?f[(n+1)][0]:null}catch(m){}}j=f[0];switch(j[1]){case"string":$.each(f,function(n,m){var p=m[0],o=m[1];if(n>1&&(o=="boolean"||o=="string"||o=="object")){var q=j[0].split("/");h.url="/"+q[0]+"?action="+q[1];if(o=="object"){h.load=p.load;h.verify=p.verify;if(p.plugin){h.url="/plugin?action=a&name="+q[0]+"&s="+q[1]}}else{if(o=="string"){h.load=p}}return false}else{h.url=j[0]}});if(f[1][1]==="object"){h.data=f[1][0];d(2)}else{d(1)}break;case"object":h.url=j[0].url;h.data=j[0].data||{};$.each(f,function(n,m){var p=m[0],o=m[1];if(n>1&&(o=="boolean"||o=="string"||o=="object")){switch(o){case"object":h.load=p.load;h.verify=p.verify;break;case"string":h.load=p;break}return true}});if(f[1][1]==="object"){h.data=f[1][0];d(2)}else{d(1)}break}if(h.load){h.load=this.load(h.load)}$.ajax({type:h.type||"POST",url:h.url,data:h.data||{},dataType:h.dataType||"JSON",complete:function(m){if(h.load){h.load.close()}},success:function(m){if(typeof h.verify=="boolean"&&!h.verify){if(k){k(m)}return false}if(typeof m==="string"){layer.msg(m,{icon:2,time:0,closeBtn:2});return false}if(h.batch){if(k){k(m)}return false}if(m.status===false&&(m.hasOwnProperty("msg")||m.hasOwnProperty("error_msg"))){if(i){i(m)}else{bt_tools.msg({status:m.status,msg:!m.hasOwnProperty("msg")?m.error_msg:m.msg})}return false}if(h.tips){bt_tools.msg(m)}if(k){k(m)}}})},command_line_output:function(b){var c=this,d=bt.get_random(15);function a(e){var i=this;for(var g in c.commandConnectionPool){var h=c.commandConnectionPool[g],f=$(h.config.el);if(e.shell===h.config.shell&&f.length){h.el=f;return h}}if(typeof e==="undefined"){e={}}this.config=$.extend({route:"/sock_shell"},e);this.xterm_config=$.extend(this.xterm_config,this.config.xterm);this.el=$(this.config.el);this.open=e.open;this.close=e.close;this.message=e.message;if(!this.config.hasOwnProperty("el")){c.msg({msg:"请输入选择器element，不可为空",status:false});return false}if(!this.config.hasOwnProperty("shell")){c.msg({msg:"请输入命令，不可为空",status:false});return false}if(this.config.hasOwnProperty("time")){setTimeout(function(){i.close_connect()},this.config.time)}this.init()}a.prototype={socket:null,socketToken:null,timeout:0,monitor_interval:2000,element_detection:null,uuid:d,fragment:[],error:0,retry:0,forceExit:false,init:function(){var e=bt.get_cookie("commandInputViewUUID"),f=this;if(!this.el[0]){if(this.error>10){return false}setTimeout(function(){f.init();this.error++},2000);return false}this.error=0;if(this.el[0].localName!=="pre"){this.el.append('<pre class="command_output_pre"></pre>');this.el=this.el.find("pre");this.config.el=this.config.el+" pre"}else{this.el.addClass("command_output_pre")}if(Array.isArray(this.config.area)){this.el.css({width:this.config.area[0],height:this.config.area[1]})}else{this.el.css({width:"100%",height:"100%"})}if(e&&typeof c.commandConnectionPool[e]!="undefined"){c.commandConnectionPool[e].close_connect();delete c.commandConnectionPool[e]}bt.set_cookie("commandInputViewUUID",this.uuid);this.element_detection=setInterval(function(){if(!$(f.config.el).length){clearInterval(f.element_detection);f.forceExit=true;f.close_connect()}},1*60*1000);this.set_full_screen();this.create_websocket_connect(this.config.route,this.config.shell);this.monitor_element()},create_websocket_connect:function(e,f){var g=this;this.socket=new WebSocket((location.protocol==="http:"?"ws://":"wss://")+location.host+e);this.socket.addEventListener("open",function(h){if(!this.socketToken){var i=document.getElementById("request_token_head").getAttribute("token");this.socketToken={"x-http-token":i}}this.send(JSON.stringify(this.socketToken));this.send(f);if(g.open){g.open()}g.retry=0});this.socket.addEventListener("close",function(h){if(!g.forceExit){if(h.code!==1000&&g.retry<=10){g.socket=g.create_websocket_connect(g.config.route,g.config.shell);g.retry++}if(g.close){g.close(h)}}});this.socket.addEventListener("message",function(i){var h=i.data;if(!h){return}g.refresh_data(h);if(g.message){g.message(h)}});return this.socket},set_full_screen:function(){},refresh_data:function(e){this.fragment.push(e);if(this.fragment.length>=300){this.fragment.splice(0,150);this.el.html(this.fragment.join(""))}else{this.el.append(e)}this.el.scrollTop(this.el[0].scrollHeight)},monitor_element:function(){var e=this;this.monitor_interval=setInterval(function(){if(!e.el.length){e.close_connect();clearInterval(e.monitor_interval)}},e.config.monitorTime||2000)},close_connect:function(){this.socket.send("");this.socket.close();delete c.commandConnectionPool[this.uuid]}};this.commandConnectionPool[d]=new a(b);return this.commandConnectionPool[d]},$clear_verify_tips:function(a){a.removeClass("bt-border-error bt-border-sucess");layer.close("tips")},$verify_tips:function(b,a,c){if(typeof c==="undefined"){c=true}b.removeClass("bt-border-error bt-border-sucess").addClass(c?"bt-border-error":"bt-border-sucess");b.focus();layer.tips('<span class="inlineBlock">'+a+"</span>",b,{tips:[1,c?"red":"#20a53a"],time:3000,area:b.width()})},$verify:function(c,a,b){if(!c){return""}if(b===true){return c?" "+a:""}if(b==="style"){return a?a+":"+c+";":c}return a?" "+a+'="'+c+'"':" "+c},$batch_success_table:function(a){var b=this,c=$(a.html).length;bt.open({type:1,title:a.title,area:a.area||["350px","350px"],shadeClose:false,closeBtn:2,content:a.content||'<div class="batch_title"><span class><span class="batch_icon"></span><span class="batch_text">'+a.title+'操作完成！</span></span></div><div class="'+(c>4?"fiexd_thead":"")+' batch_tabel divtable" style="margin: 15px 30px 15px 30px;overflow: auto;height: 200px;"><table class="table table-hover"><thead><tr><th>'+a.th+'</th><th style="text-align:right;width:120px;">操作结果</th></tr></thead><tbody>'+a.html+"</tbody></table></div>",success:function(){if(c>4){b.$fixed_table_thead(".fiexd_thead")}}})},$fixed_table_thead:function(a){$(a).scroll(function(){var b=this.scrollTop;this.querySelector("thead").style.transform="translateY("+b+"px)"})},$piugin_view_set:function(c,a){var b=$(typeof c==="string"?("#layui-layer"+c):c).hide(),d=$(window);setTimeout(function(){var f=a.width||b.width(),e=a.height||b.height();b.css($.extend(a,{left:((d.width()-f)/2),top:((d.height()-e)/2)})).addClass("custom_layer")},50);setTimeout(function(){b.show()},500)}};$.fn.serializeObject=function(){var a=Object.prototype.hasOwnProperty;return this.serializeArray().reduce(function(b,c){if(!a.call(b,c.name)){b[c.name]=c.value}return b},{})};Array.prototype.concatObject=function(){var b=this.concat(),c=[];for(var a=0;a<b.length;a++){c.push($.extend(true,{},b[a]))}return c};